<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
    <link rel="icon" type="image/x-icon" href="KFGL.jpg">
<title>Welcome!</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{
  font-family:system-ui;
  background:#FDD7D7;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.card{
  background:white;
  padding:2rem;
  border-radius:16px;
  text-align:center;
}
    .tick-option {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 12px;
  font-weight: 500;
}

.tick-option input {
  width: 18px;
  height: 18px;
}

.popup-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.55);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 3000;
}

.popup-box {
  background: #fff;
  padding: 25px;
  width: 90%;
  max-width: 420px;
  border-radius: 16px;
}
.popup-overlay {
  pointer-events: all;
}

.card {
  pointer-events: none;
}

</style>
</head>

<body>

<!-- POPUP OVERLAY -->
<div id="popupOverlay" class="popup-overlay">
  <div class="popup-box">

    <h3>Membership Agreement</h3>

    <label class="tick-option">
      <input type="checkbox" id="waiverCheck">
      I have read and agree to the
      <a href="Waiver.pdf" target="_blank">Terms & Liability Waiver</a>
    </label>
     <button id="continueBtn" type="button" disabled>
      Continue
    </button>

  </div>
</div>


<div class="card">
  <h2>Welcome to the Garden ðŸŒ¸</h2>
  <p>Your membership is active.</p>
<button id="dashboardBtn" disabled>Go to Dashboard</button>
</div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const overlay = document.getElementById("popupOverlay");
  overlay.style.display = "flex";

  // lock background
  document.body.style.overflow = "hidden";
});
</script>

</body>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const checkbox = document.getElementById("waiverCheck");
  const btn = document.getElementById("continueBtn");
  const overlay = document.getElementById("popupOverlay");

  checkbox.addEventListener("change", () => {
    btn.disabled = !checkbox.checked;
  });

  btn.addEventListener("click", async () => {
    const res = await fetch("/api/accept-waiver", {
      method: "POST",
      credentials: "include"
    });

    if (res.ok) {
      overlay.style.display = "none";
      document.body.style.overflow = "auto";
        window.location.href = "complete-profile.html";
    } else {
      alert("Waiver acceptance failed.");
    }
  });
});
</script>

    <script>
document.getElementById("continueBtn").onclick = async () => {
  const res = await fetch("/api/accept-waiver", {
    method: "POST",
    credentials: "include"
  });

  if (res.ok) {
    window.location.href = "MembersDashboard.html";
  } else {
    alert("Please log in again.");
  }
};
</script>
<script> 

module.exports.sendWelcomeEmail = async (user, txnId) => {
  const mailOptions = {
    from: `"Kelowna Flower Gardens" <${process.env.EMAIL_USER}>`,
    to: user.email,
    subject: "ðŸŒ¸ Welcome to Kelowna Flower Gardens!",
    html: `
      <h2>Welcome, ${user.name} ðŸŒ·</h2>

      <p>Thank you for becoming a member of <strong>Kelowna Flower Gardens</strong>.</p>

      <p><strong>Membership Details:</strong></p>
      <ul>
        <li>Annual Membership: $50.00 CAD</li>
        <li>PST: $6.00</li>
        <li>Total Paid: <strong>$56.00 CAD</strong></li>
      </ul>

      <p><strong>PayPal Transaction ID:</strong><br>${txnId}</p>

      <p>You now have access to:</p>
      <ul>
        <li>Six Weeks of Summer garden parties</li>
        <li>Member-only resources</li>
        <li>Voting & awards</li>
        <li>Member dashboard access</li>
      </ul>

      <p>
        ðŸ‘‰ <a href="https://kelownaflowergardens.com/Members.html">
        Visit Member Dashboard</a>
      </p>

      <p>ðŸŒ¹ Weâ€™re so glad to have you!</p>

      <p>
        â€” Kelowna Flower Gardens<br>
        kelownaflowergardens@gmail.com
      </p>
    `
  };

  await transporter.sendMail(mailOptions);
};
app.enable("trust proxy");

app.use((req, res, next) => {
  if (req.secure) return next();
  res.redirect(`https://${req.headers.host}${req.url}`);
});</script>
    
    

</html>
