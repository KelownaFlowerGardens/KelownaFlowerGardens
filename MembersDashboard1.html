<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Member Dashboard</title>
<link rel="icon" type="image/x-icon" href="KFGL.jpg">
<link rel="stylesheet" href="style.css">

<style>
:root {
  --pink:#F68686;
  --light:#FDD7D7;
  --muted:#666;
  --radius:14px;
  --max:1200px;
}

* {box-sizing:border-box;}

body {
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background: linear-gradient(180deg,var(--pink),#fff);
  color:#333;
}

/* Header */
header { text-align:center; padding:1rem; }
header img { width:100%; max-height:360px; object-fit:cover; border-radius:var(--radius);}
header h1 { color:var(--pink); margin:1rem 0 .25rem;}
header p { color:var(--muted); margin:0;}

/* Navigation */
nav {
  display:flex; flex-wrap:wrap; justify-content:center; gap:.5rem; margin:1rem 0;
}
nav a {
  text-decoration:none; padding:.5rem .9rem; background:#fff; color:var(--pink); border-radius:20px;
  font-weight:600; font-size:.95rem;
}
nav a:hover { background:var(--pink); color:#fff; }

/* Layout */
.wrapper { display:flex; max-width:var(--max); margin:auto; padding:1rem; gap:1.5rem; }
.sidebar { width:260px; background:#fff; border-radius:var(--radius); padding:1rem; }
.sidebar h5 { margin:.75rem 0; color:var(--pink); }
.sidebar a,.dropdown-btn {
  display:block; width:100%; padding:.6rem; margin:.2rem 0; background:#fff; color:var(--pink);
  border:none; text-align:left; font-size:.95rem; cursor:pointer;
}
.sidebar a:hover,.dropdown-btn:hover { background:var(--pink); color:#fff; }
.dropdown-container { display:none; padding-left:1rem; }

.menu-btn {
  display:none; position:fixed; top:10px; right:10px; z-index:2000; font-size:24px;
  padding:.4rem .7rem; border:none; background:var(--pink); color:#fff; border-radius:6px;
}

@media(max-width:900px){
  .wrapper { flex-direction:column; }
  .sidebar{ position:fixed; top:0; right:-280px; height:100vh; z-index:1500; transition:.3s; }
  .sidebar.active{ right:0; }
  .menu-btn{ display:block; }
}

/* Member avatar dropdown */
.member-avatar{ position:relative; margin-left:auto; }
.avatar-btn{ border:none; background:none; cursor:pointer; padding:0; }
.avatar-btn img{ width:42px; height:42px; border-radius:50%; object-fit:cover; border:2px solid #F68686; }
.member-dropdown{
  display:none; position:absolute; right:0; top:120%; background:#fff; width:220px;
  border-radius:14px; box-shadow:0 12px 30px rgba(0,0,0,.18); overflow:hidden; z-index:2000;
}
.member-name{ padding:.75rem 1rem; font-weight:600; color:#F68686; border-bottom:1px solid #eee; text-align:center; }
.member-dropdown a{ display:block; padding:.7rem 1rem; text-decoration:none; color:#444; font-size:.9rem; }
.member-dropdown a:hover{ background:#F68686; color:white; }
.member-dropdown .logout{ color:#c0392b; }
.member-dropdown .logout:hover{ background:#c0392b; color:white; }

/* Status badges */
.status { width:10px; height:10px; border-radius:50%; display:inline-block; margin-right:6px; }
.online { background:#2ecc71; }
.offline { background:#aaa; }

/* Badge */
.badge {
  position:absolute; top:-6px; right:-6px;
  background:red; color:white;
  font-size:12px; padding:2px 6px;
  border-radius:50%; display:none;
}

/* Dashboard cards */
.dashboard{ max-width:900px; margin:auto; padding:2rem; }
.card{ background:#fff; border-radius:14px; padding:1.5rem; margin-bottom:1rem; }
h1{color:#F68686}
a.button{ display:inline-block; padding:.6rem 1.2rem; border-radius:25px; background:#F68686; color:#fff; text-decoration:none; font-weight:600; }

/* Messenger toggle and modal */
#messengerToggle{
  position:fixed; bottom:20px; right:20px;
  background:#F68686; color:#fff;
  border:none; border-radius:50px;
  padding:.7rem 1.2rem;
  font-size:1.2rem; cursor:pointer;
  z-index:9999;
}

#messengerModal{
  position:fixed; bottom:80px; right:20px;
  width:320px; height:460px;
  background:#fff; border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.3);
  display:none; flex-direction:column;
  z-index:10000;
}

#messengerHeader{
  background:#F68686; color:#fff;
  padding:.7rem; font-weight:600;
  display:flex; justify-content:space-between;
}

#membersList{
  max-height:70px; overflow:auto;
  padding:.4rem; border-bottom:1px solid #eee;
}

.member{
  display:flex; align-items:center;
  gap:.4rem; cursor:pointer;
}

#messages{
  flex:1; padding:.5rem;
  overflow-y:auto; font-size:.9rem;
}

.message.self{ text-align:right }
.message.other{ text-align:left }
.message img{ max-width:180px; border-radius:8px }

.chat-input{
  display:flex; gap:4px;
  padding:.4rem;
}
#chatInput{ flex:1; padding:.4rem }
#emojiPicker{
  display:none; padding:.4rem;
  flex-wrap:wrap; gap:4px;
}
#emojiPicker span{ cursor:pointer }
  #rsvpOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

#rsvpPopup{
  background:#fff;
  border-radius:16px;
  padding:1.8rem;
  width:90%;
  max-width:360px;
  text-align:center;
}

#rsvpPopup h3{
  color:#F68686;
  margin-top:0;
}

.calendar-btn{
  display:inline-block;
  margin:.6rem 0;
  padding:.5rem 1rem;
  background:#F68686;
  color:#fff;
  border-radius:20px;
  text-decoration:none;
  font-weight:600;
}

.rsvp-label{
  display:block;
  margin:1rem 0;
  font-weight:600;
}

select{
  width:100%;
  padding:.5rem;
  margin-top:.4rem;
  border-radius:8px;
  border:1px solid #ccc;
}

.popup-actions{
  display:flex;
  gap:.6rem;
  justify-content:center;
  margin-top:1rem;
}

.confirm-btn{
  background:#F68686;
  color:#fff;
  border:none;
  padding:.6rem 1.2rem;
  border-radius:20px;
  cursor:pointer;
}

.cancel-btn{
  background:#ddd;
  border:none;
  padding:.6rem 1.2rem;
  border-radius:20px;
  cursor:pointer;
}

#popupStatus{
  margin-top:.8rem;
  font-size:.9rem;
}

</style>
</head>
<body>

<button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>

<header>
  <img src="01126.jpg" alt="Flowers of the Okanagan">
  <h1>Kelowna Flower Gardens</h1>
  <p>Kelowna‚Äôs Flower Garden Club</p>
  <nav>
    <a href="MemberHome.html">Main</a>
    <a href="MemberGardenDesign.html">Garden Design</a>
    <a href="MemberAbout.html">About</a>
    <a href="MemberRegional Species.html">Regional Species</a>
    <a href="MemberAwards.html">Awards</a>
    <a href="MemberRoses.html">Roses</a>
    <a href="MemberValley Art.html">Valley Art</a>
    <a href="MemberBridalBouquets.html">Bridal Bouquets</a>
    <a href="MemberEvents.html">Events</a>
    <a href="MemberResources.html">Resources</a>
    <a href="MemberCalendar.html">Calendar</a>
    <a href="MembersDashboard.html">Members</a>
    <a href="MemberContact.html">Contact</a>
  </nav>
</header>

<div class="wrapper">
  <div class="dashboard">
    <h1>Welcome, <span id="username"></span></h1>
    <div class="card">
      <p><strong>Email:</strong> <span id="email"></span></p>
      <p><strong>Membership:</strong> <span id="plan"></span></p>
      <p><strong>Status:</strong> <span id="status"></span></p>
      <p><strong>Member Since:</strong> <span id="since"></span></p>
    </div>

    <div class="card">
      <h3>Member Benefits</h3>
      <ul>
        <li>Garden Party Event Access</li>
        <li>Flower Garden Awards Voting</li>
        <li>Member-Only Resources - Newsletters</li>
        <li>Garden Party Hosting</li>
        <li>Discounts at Affiliated Businesses</li>
        <li>Online Retail</li>
      </ul>
    </div>

    <!-- RSVP / Events Section -->
    <div class="card" id="eventsSection">
      <h3>Upcoming Events & RSVP</h3>
      <ul id="eventsList"></ul>
    </div>

    <div class="card">
      <a class="button" href="MemberRoses.html">View Rose Database</a>
      <a class="button" href="MemberCalendar.html">Events Calendar</a>
      <a class="button" href="MyAccount.html">My Account</a>
    </div>
  </div>
</div>

<!-- Messenger toggle and modal -->
<button id="messengerToggle">üí¨<span id="chatBadge" class="badge"></span></button>

<div id="messengerModal">
  <div id="messengerHeader">
    Members Chat
    <span id="closeMessenger">√ó</span>
  </div>
  <div id="membersList"></div>
  <div id="messages"></div>
  <div id="typingIndicator"></div>

  <div class="chat-input">
    <input id="chatInput" placeholder="Type a message‚Ä¶" />
    <button id="emojiBtn">üòä</button>
    <button id="imageBtn">üì∑</button>
    <button id="sendBtn">Send</button>
    <input type="file" id="imageInput" accept="image/*" hidden>
  </div>
  <div id="emojiPicker"></div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
// Dummy user data
const username = "Member1";
document.getElementById("username").textContent = username;

// Dummy events list
const events = [
  {id:"event1", name:"Spring Garden Party"},
  {id:"event2", name:"Rose Competition"},
  {id:"event3", name:"Autumn Flower Show"}
];
const eventsList = document.getElementById("eventsList");
events.forEach(e=>{
  const li = document.createElement("li");
  li.innerHTML = `<strong>${e.name}</strong> 
                  <button onclick="joinEventChat('${e.id}')">Join Chat</button>`;
  eventsList.appendChild(li);
});

// Chat logic
const socket = io();
const modal = document.getElementById("messengerModal");
const toggleBtn = document.getElementById("messengerToggle");
const closeBtn = document.getElementById("closeMessenger");
const messagesDiv = document.getElementById("messages");
const membersList = document.getElementById("membersList");
const chatInput = document.getElementById("chatInput");
const sendBtn = document.getElementById("sendBtn");
const badge = document.getElementById("chatBadge");
const emojiBtn = document.getElementById("emojiBtn");
const emojiPicker = document.getElementById("emojiPicker");
const imageBtn = document.getElementById("imageBtn");
const imageInput = document.getElementById("imageInput");
const typingDiv = document.getElementById("typingIndicator");

let currentRoom = "general";
let unread = 0;

function joinEventChat(eventId){
  currentRoom = eventId;
  messagesDiv.innerHTML = "";
  modal.style.display = "flex";
}

// Toggle modal
toggleBtn.onclick = () => { modal.style.display="flex"; unread=0; badge.style.display="none"; };
closeBtn.onclick = () => modal.style.display="none";

// Send message
sendBtn.onclick = sendMessage;
chatInput.onkeypress = e => { if(e.key==="Enter") sendMessage(); };

function sendMessage(){
  const text = chatInput.value.trim();
  if(!text) return;
  socket.emit("chatMessage",{room:currentRoom,text,type:"text",username});
  chatInput.value="";
}

// Typing indicator
let typingTimer;
chatInput.oninput = () => {
  socket.emit("typing", currentRoom, username);
  clearTimeout(typingTimer);
  typingTimer = setTimeout(()=>socket.emit("stopTyping", currentRoom, username),800);
};

// Emoji picker
["üòÄ","üòÇ","üòç","ü•∞","üòé","üëç","üéâ","üåπ"].forEach(e=>{
  const span = document.createElement("span");
  span.textContent = e;
  span.onclick = ()=>chatInput.value+=e;
  emojiPicker.appendChild(span);
});
emojiBtn.onclick = ()=>emojiPicker.style.display = emojiPicker.style.display==="flex"?"none":"flex";

// Image upload
imageBtn.onclick = ()=>imageInput.click();
imageInput.onchange = ()=>{
  const file=imageInput.files[0];
  const reader=new FileReader();
  reader.onload=e=>socket.emit("chatMessage",{room:currentRoom,text:e.target.result,type:"image",username});
  reader.readAsDataURL(file);
};

// Receive messages
socket.on("chatMessage", msg=>{
  if(msg.room !== currentRoom) return;
  const div = document.createElement("div");
  div.className="message "+(msg.username===username?"self":"other");
  div.innerHTML = msg.type==="image"? `<img src="${msg.text}">` : `<strong>${msg.username}:</strong> ${msg.text}`;
  messagesDiv.appendChild(div);
  messagesDiv.scrollTop=messagesDiv.scrollHeight;
});

// Typing events
socket.on("typing",(room,user)=>{
  if(room===currentRoom) typingDiv.textContent=user+" is typing‚Ä¶";
});
socket.on("stopTyping",(room,user)=>{
  if(room===currentRoom) typingDiv.textContent="";
});

// Dummy online members
socket.on("members",(members)=>{
  membersList.innerHTML="";
  members.forEach(m=>{
    const div=document.createElement("div");
    div.className="member";
    div.innerHTML=`<span class="status ${m.online?'online':'offline'}"></span>${m.username}`;
    membersList.appendChild(div);
  });
});
</script>
  <!-- RSVP POPUP -->
<div id="rsvpOverlay" style="display:none;">
  <div id="rsvpPopup">
    <h3 id="popupTitle"></h3>
    <p id="popupDate"></p>

    <a id="calendarLink" target="_blank" class="calendar-btn">
      ‚ûï Add to Calendar
    </a>

    <label class="rsvp-label">
      RSVP Status
      <select id="rsvpSelect">
        <option value="yes">Yes, attending</option>
        <option value="maybe">Maybe</option>
        <option value="no">Not attending</option>
      </select>
    </label>

    <div class="popup-actions">
      <button onclick="submitPopupRSVP()" class="confirm-btn">Confirm RSVP</button>
      <button onclick="closeRSVP()" class="cancel-btn">Cancel</button>
    </div>

    <div id="popupStatus"></div>
  </div>
</div>

  <script>
let selectedEventId = null;

/* OPEN POPUP */
function openRSVP(title, date, eventId){
  selectedEventId = eventId;

  document.getElementById("popupTitle").textContent = title;
  document.getElementById("popupDate").textContent =
    "Event Date: " + new Date(date).toDateString();

  /* Google Calendar link */
  const start = date.replace(/-/g,"") + "T180000";
  const end   = date.replace(/-/g,"") + "T210000";

  document.getElementById("calendarLink").href =
    `https://www.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&dates=${start}/${end}`;

  document.getElementById("rsvpOverlay").style.display="flex";
  document.getElementById("popupStatus").textContent="";
}

/* CLOSE POPUP */
function closeRSVP(){
  document.getElementById("rsvpOverlay").style.display="none";
}

/* SUBMIT RSVP */
async function submitPopupRSVP(){
  const status = document.getElementById("rsvpSelect").value;
  const msg = document.getElementById("popupStatus");

  msg.textContent = "Submitting RSVP‚Ä¶";

  try{
    const res = await fetch("/api/rsvp",{
      method:"POST",
      credentials:"include",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({
        eventId: selectedEventId,
        response: status
      })
    });

    if(!res.ok) throw new Error();

    msg.textContent = "‚úÖ RSVP saved. Organizer notified.";
    setTimeout(closeRSVP, 1500);

  }catch{
    msg.textContent = "‚ùå Failed to submit RSVP.";
  }
}
</script>


</body>
</html>
