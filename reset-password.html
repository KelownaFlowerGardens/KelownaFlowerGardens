<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reset Password</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:system-ui;
  background:#FDD7D7;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.card{
  background:white;
  padding:2rem;
  border-radius:14px;
  max-width:420px;
  width:100%;
}
h2{ color:#F68686; text-align:center; }
input,button{
  width:100%;
  padding:.75rem;
  margin-top:1rem;
  border-radius:10px;
}
button{
  background:#F68686;
  border:none;
  color:white;
}
.msg{
  text-align:center;
  margin-top:1rem;
}
</style>
</head>

<body>

<div class="card">
  <h2>Reset Password</h2>

  
<form id="newPassForm">
  <input
    type="password"
    id="newPassword"
    placeholder="New password"
    required
  >

  <input
    type="password"
    id="confirmPassword"
    placeholder="Confirm new password"
    required
  >

  <button type="submit">Update Password</button>
</form>

<p id="error"></p>

<script>
const token = new URLSearchParams(window.location.search).get("token");

document.getElementById("newPassForm").addEventListener("submit", async e => {
  e.preventDefault();

  if (newPassword.value !== confirmPassword.value) {
    error.textContent = "Passwords do not match.";
    return;
  }

  const res = await fetch("/api/reset-password", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    credentials: "include",
    body: JSON.stringify({
      token,
      password: newPassword.value
    })
  });

  if (res.ok) {
    window.location.href = "MembersDashboard.html";
  } else {
    error.textContent = "Reset link invalid or expired.";
  }
});
</script>

<script>
const token = new URLSearchParams(window.location.search).get("token");

document.getElementById("newPassForm").onsubmit = async e => {
  e.preventDefault();

  const res = await fetch("/api/password-reset", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      token,
      newPassword: password.value
    })
  });

  if (res.ok) {
    alert("Password updated. Please log in.");
    window.location.href = "Members.html";
  } else {
    alert("Reset failed.");
  }
};
document.getElementById("resetForm").addEventListener("submit", async e => {
  e.preventDefault();

  msg.textContent = "Sending reset linkâ€¦";

  await fetch("/api/request-password-reset", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ email: email.value })
  });

  msg.textContent = "A reset email-link has been sent.";
});
</script>

</body>
</html>
