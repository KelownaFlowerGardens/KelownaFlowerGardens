<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reset Password</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:system-ui;
  background:#FDD7D7;
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.card{
  background:white;
  padding:2rem;
  border-radius:14px;
  max-width:420px;
  width:100%;
}
h2{ color:#F68686; text-align:center; }
input,button{
  width:100%;
  padding:.75rem;
  margin-top:1rem;
  border-radius:10px;
}
button{
  background:#F68686;
  border:none;
  color:white;
}
.msg{
  text-align:center;
  margin-top:1rem;
}
</style>
</head>

<body>

<div class="card">
  <h2>Reset Password</h2>
  
<form id="newPassForm">
    <form id="resetForm">
    <input type="email" id="email" placeholder="Your email" required>
    <button type="submit">Send Reset Link</button>
        <input type="oldpassword" id="password" placeholder="old password" required>
  <input type="password" id="password" placeholder="new password" required>
      <input type="confrimnewpassword" id="password" placeholder="confrim new password" required>
    <link rel="icon" type="image/x-icon" href="KFGL.jpg">
  <button>Update Password</button>
  </form>

  <div class="msg" id="msg"></div>

  <p style="text-align:center;margin-top:1rem;">
    <a href="MyAccount.html">Back to account</a>
  </p>
</div>

<script>
const token = new URLSearchParams(window.location.search).get("token");

document.getElementById("newPassForm").onsubmit = async e => {
  e.preventDefault();

  const res = await fetch("/api/password-reset", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      token,
      newPassword: password.value
    })
  });

  if (res.ok) {
    alert("Password updated. Please log in.");
    window.location.href = "Members.html";
  } else {
    alert("Reset failed.");
  }
};
document.getElementById("resetForm").addEventListener("submit", async e => {
  e.preventDefault();

  msg.textContent = "Sending reset linkâ€¦";

  await fetch("/api/request-password-reset", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ email: email.value })
  });

  msg.textContent = "A reset email-link has been sent.";
});
</script>

</body>
</html>
